<div class="max-w-md w-full space-y-8">

  <img class="m-auto" src="/web-2fa/img/logo.png">

  <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">Login Form</h2>

<form class="" id="form-login">
  <div class="step1">
    <input class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
           type="email" placeholder="Email" name="email" id="email" placeholder="email@example.com">
  </div>
  <div class="step1">
    <input class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
           type="password" placeholder="Password" name="password" id="password" placeholder="password">
  </div>
  <br>
  <p class="hidden text-red-500 pb-2" id="form-error"></p>
  <p class="hidden pb-2" id="form-info"></p>

  <button type="submit" id="form-submit" class="step1 group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
    <span class="absolute left-0 inset-y-0 flex items-center pl-3">
      <svg class="h-5 w-5 text-indigo-500 group-hover:text-indigo-400" x-description="Heroicon name: solid/lock-closed" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
<path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
</svg>
    </span>
    Log in
  </button>

  <div class="step2 hidden"><button id="back-to-login" type="button">Back to login</button></div>
  <div class="step2 hidden"><button id="resend-validation" type="button">Resend validation code</button></div>
  <div class="step1 py-2"><a class="font-medium text-indigo-600 hover:text-indigo-500 text-sm" id="forgot-password" href="/password-reset">Forgotten your password?</a></div>
</form>

</div>

<script>(function() {
var form = document.getElementById('form-login');
var form_error = document.getElementById('form-error');
var form_info = document.getElementById('form-info');
var form_submit = document.getElementById('form-submit');
var step_1_elements = document.querySelectorAll('.step1');
var step_2_elements = document.querySelectorAll('.step2');
var forgot_password = document.getElementById('forgot-password');
var back_to_login = document.getElementById('back-to-login');
var resend_validation = document.getElementById('resend-validation');

function show_step1() {
  step_1_elements.forEach(function(el) { el.classList.remove('hidden') });
  step_2_elements.forEach(function(el) { el.classList.add('hidden') });
}

function show_step2() {
  step_1_elements.forEach(function(el) { el.classList.add('hidden') });
  step_2_elements.forEach(function(el) { el.classList.remove('hidden') });
}

// Forgot password
forgot_password.onclick = function(e) {
  console.log("TODO forgot password");
}

// Back to login
back_to_login.onclick = function(e) { show_step1() }

// Form resend code
resend_validation.onclick = function(e) {
  resend_validation.disabled = true;
  fetch('/login/resend', { method: 'POST' })
    .then(function(response){
      if (!response.ok) {
        response.text().then(function(data){
          form_error.innerText = data;
          form_error.classList.remove('hidden');
        })
      } else {
        form_info.innerText = 'validation_email_resent';
        form_info.classList.remove('hidden');
      }
    }).catch(function(error){
      console.error(error);
      resend_validation.disabled = false;
    });
}

// Form submit
form.addEventListener('submit', function(e){
  e.preventDefault();
  form_error.classList.add('hidden');
  form_submit.disabled = true;
  resend_validation.disabled = false;
  fetch("/login", { method: 'POST', body: new FormData(e.target) })
    .then(function(response){
      if (!response.ok) {
        response.text().then(function(data) {
          form_error.innerText = data;
          form_error.classList.remove('hidden');
        });
      } else {
        show_step2();
      }
      form_submit.disabled = false;
    })
    .catch(function (error) {
      console.error(error);
      form_submit.disabled = false;
	  });
});

})();</script>